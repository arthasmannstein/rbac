# Ролевая модель доступа

Этот репозиторий содержит описанную в Markdown и YAML формате **ролевую модель доступа**, применимую к многопроектной инфраструктуре. Модель построена на принципах атомарности, агрегации и проектной изоляции.

##  Структура репозитория

```text
.
├── .github/
│   └── workflows/
│       └── validate_and_generate.yml       # Единый CI: валидация + генерация + PR
├── diagrams/
│   └── roles_graph.mmd                     # Mermaid-граф агрегированных ролей
├── docs/
│   └── roles_table.md                      # Markdown-таблица агрегированных ролей
├── export/
│   └── roles_for_avanpost.yaml             # YAML-экспорт для IDM (например, Avanpost)
├── matrix/
│   └── roles_table.xlsx                    # Excel-матрица ролей и разрешений
├── permissions/
│   └── *.md                                # Атомарные разрешения (read:gitlab, write:vault и т.д.)
├── roles/
│   ├── atomic/                             # Атомарные роли (vault-read, gitlab-admin и т.д.)
│   ├── aggregated/                         # Агрегаты (dev, qa, teamlead-dev и др.)
│   ├── infrastructure/                     # Инфраструктурные роли (ldap-admin, os-access и др.)
│   └── projects/                           # Проектные роли (project-x-dev, project-y-qa и т.д.)
├── scripts/
│   ├── gen_roles_table.py                  # Генерация таблиц, Excel, YAML
│   ├── gen_mermaid.py                      # Построение Mermaid-графа
│   └── validate_role_permissions.py        # Валидация модели и генерация отчёта
├── validation_report.md                    # Отчёт по валидации (генерируется автоматически)
├── .gitignore                              # Исключение служебных и временных файлов
└── README.md                               # Основная документация по ролевой модели
```

---

##  Типы ролей

| Тип                | Назначение                                                |
|--------------------|-----------------------------------------------------------|
| **Атомарные**      | Минимальные логические блоки доступа (одна операция)      |
| **Агрегированные** | Набор атомарных ролей, отражающих функции (dev, qa, teamlead) |
| **Проектные**      | То же, что агрегированные, но ограниченные по проекту     |
| **Инфраструктурные** | Для платформенных систем: ОС, LDAP, мониторинг           |

---

##  Автоматизация (CI/CD)

GitHub Actions реализует полную автоматическую цепочку:

- Валидация модели (`validation_report.md`)
- Генерация:
  - Markdown-таблицы
  - Excel-матрицы
  - YAML-файла для Avanpost
  - Mermaid-графа
- Создание Pull Request с изменениями

Workflow: `.github/workflows/validate_and_generate.yml`

---

##  Как внести изменения

1. Отредактировать `.md` в `roles/` или `permissions/`
2. Сделать `commit` и `push`
3. GitHub Actions:
   - проверит модель
   - сгенерирует артефакты
   - создаст PR автоматически

---

##  Импорт в Avanpost

Экспорт `roles_for_avanpost.yaml` создаётся автоматически. Он адаптирован под Avanpost IDM.

---

##  Отчёт валидации

Файл `validation_report.md` содержит:

- Ошибки и предупреждения по структуре модели
- Статистику по ролям и разрешениям
- Отображается в PR при любом изменении модели

---

##  Пример роли

```markdown
# Атомарная роль: gitlab-read

**Сервис:** GitLab
**Тип:** атомарная

## Разрешение
- `read:gitlab`

## Назначение
Разрешает только просмотр репозиториев и активности в GitLab.
```

---

##  Контакты / поддержка

Для вопросов по модели tg @amquad.
